###### **什么是ICP算法？**

    ICP（Iterative Closest Point），即最近点迭代算法，是最为经典的数据配准算法。其特征在于，通过求取源点云和目标点云之间的对应点对，
    基于对应点对构造旋转平移矩阵，并利用所求矩阵，将源点云变换到目标点云的坐标系下，估计变换后源点云与目标点云的误差函数，
    若误差函数值大于阀值，则迭代进行上述运算直到满足给定的误差要求.

    ICP算法采用最小二乘估计计算变换矩阵，原理简单且具有较好的精度，但是由于采用了迭代计算，导致算法计算速度较慢，
    而且采用ICP进行配准计算时，其对待配准点云的初始位置有一定要求，若所选初始位置不合理，则会导致算法陷入局部最优。


###### **引言**
    给定两个来自不同坐标系的三维数据点集，找到两个点集空间的变换关系，使得两个点集能统一到同一坐标系统中，即配准过程。配准的目标是在全局坐标框架中找到单独获取的视图的相对位置和方向，使得它们之间的相交区域完全重叠。对于从不同视图（views）获取的每一组点云数据，需要一个能够将它们对齐在一起的单一点云模型，从而可以应用后续处理步骤，如分割和对象重构。
    这篇博文就基于PCL中的ICP算法，实现不同视图点云数据的配准，并延伸相关知识。



###### **配准模型**
    两个(pairwise)点云数据集的配准，即在其中一个数据上进行旋转和平移，使得他们之间的相交区域完全重合。这里输出结果是一个（4x4）刚性（rigid）变换矩阵。
    两个数据集的计算步骤：
        1. 识别最能代表两个数据集中的场景的兴趣点（interest points）（即关键点 keypoints）
        2. 在每个关键点处，计算特征描述符;
        3. 从特征描述符集合以及它们在两个数据集中的x,y,z位置，基于特征和位置之间的相似性来估计对应关系;
        4. 假设数据被认为包含噪声的，并不是所有的对应关系都是有效的，所以舍弃对配准过程产生负面影响的那些负影响对应关系;
        5. 从剩下的一组好的对应关系中，估计一个变换行为。



###### **关键点**
    点云中的特征点是一些兴趣点，如目标的转点、角点等具有明显特征（feature）的点或点集。



###### **特征描述**
    基于发现的关键点，提取特征组合信息并生成向量来进行比较。


###### **一致性估计 correspondence estimate**
    给定两组数据获取相应的特征描述向量，找到相应的特征以在数据中找到重叠的部分。


###### **舍弃糟糕的一致性估计**
    不是所有的一致性估计都是正确的，错误的一致性将对变换产生负影响，因此需要舍弃。


###### **变换 transformation**
    步骤：
        1. 根据一致性评价误差度量（error metric）
        2. 估计变换矩阵
        3. 优化点结构



###### **迭代最近点 Iterative Closest Point （ICP）**
    ICP算法本质上是基于最小二乘法的最优配准方法。该算法重复进行选择对应关系点对，计算最优刚体变换这一过程，直到满足正确配准的收敛精度要求。ICP是一个广泛使用的配准算法，主要目的就是找到旋转和平移参数，将两个不同坐标系下的点云，以其中一个点云坐标系为全局坐标系，另一个点云经过旋转和平移后两组点云重合部分完全重叠。ICP算法最早由Chen and Medioni，and Besl and McKay提出。

    算法的输入：参考点云和目标点云，停止迭代的标准。
    算法的输出：旋转和平移矩阵，即转换矩阵。




###### **基本过程**
    1.对于目标点云中的每个点，匹配参考点云（或选定集合）中的最近点。
    2.求得使上述对应点对计算均方根（root mean square，RMS）最小的刚体变换，求得平移参数和旋转参数。
    3.使用获得的转换矩阵来转换目标点云。
    4.迭代（重新关联点），直到满足终止迭代的条件（迭代次数或误差小于阈值）。这里的误差最小，可以是相邻两次均方根差的绝对值小于某一限差。



###### **可能存在的问题**
    1.算法收敛于局部最小误差。
    2.噪声或异常数据可能导致算法无法收敛或错误。
    3.在进行ICP算法第一步要确定一个迭代初值，选取的初值将对最后配准结果产生重要的影响，如果初值选择不合适，算法可能就会限入局部最优，使得迭代不能收敛到正确的配准结果。















